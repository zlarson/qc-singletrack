using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Metadata.Builders;
using QCSingleTrack.Domain;

namespace QCSingleTrack.Infrastructure.Data.Configurations;

public class CurrentTrailStatusConfiguration : IEntityTypeConfiguration<CurrentTrailStatus>
{
    public void Configure(EntityTypeBuilder<CurrentTrailStatus> builder)
    {
        builder.ToTable("CurrentTrailStatuses");
        builder.HasKey(s => s.TrailId);

        builder.Property(s => s.Status).HasMaxLength(50);
        builder.Property(s => s.Source).HasMaxLength(100);
        builder.Property(s => s.Reason).HasMaxLength(1000);
        builder.Property(s => s.LastScrapedTime).IsRequired();

        // Configure one-to-one relationship with Trail
        builder.HasOne(s => s.Trail)
            .WithOne(t => t.CurrentTrailStatus)
            .HasForeignKey<CurrentTrailStatus>(s => s.TrailId)
            .OnDelete(DeleteBehavior.Cascade);
    }
}
